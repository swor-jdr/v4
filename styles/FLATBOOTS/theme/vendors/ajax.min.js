!function(t){"use strict";phpbb.addAjaxCallback("mark_forums_read",function(a){var e=a.NO_UNREAD_POSTS,o=a.UNREAD_POSTS,n={"forum-unread":"forum-read",forum_unread_subforum:"forum_read_subforum",forum_unread_locked:"forum_read_locked"};t("tr").find('i[class*="forum-unread"]').each(function(){var a=t(this);t.each(n,function(t,e){a.hasClass(t)&&a.removeClass(t).addClass(e)}),a.parent().parent('[title="'+o+'"]').attr("title",e),t("td").find('i[title="'+o+'"]').attr("title",e)}),t('a.subforum[class*="unread"]').removeClass("unread").addClass("read"),t("#active_topics").length&&phpbb.ajaxCallbacks.mark_topics_read.call(this,a,!1),t('[data-ajax="mark_forums_read"]').attr("href",a.U_MARK_FORUMS),phpbb.closeDarkenWrapper(3e3)}),phpbb.addAjaxCallback("mark_topics_read",function(a,e){var o,n=a.NO_UNREAD_POSTS,i=a.UNREAD_POSTS,r={global_unread:"global_read","forum-unread":"forum-read",announce_unread:"announce_read",sticky_unread:"sticky_read",topic_unread:"topic_read"},l=["","_hot","_hot_mine","_locked","_locked_mine","_mine"],s={},d=[];"undefined"==typeof e&&(e=!0),t.each(r,function(a,e){t.each(l,function(t,o){return"_hot"!==o&&"_hot_mine"!==o||"topic_unread"===a?(s[a+o]=e+o,void d.push(a+o)):!0})}),o="."+d.join(",."),t("tr").find(o).each(function(){var a=t(this);t.each(s,function(t,e){a.hasClass(t)&&a.removeClass(t).addClass(e)}),a.parent().find('[title="'+i+'"]').attr("title",n)}),t("a").has("i.topic-newest").remove(),e&&t('[data-ajax="mark_topics_read"]').attr("href",a.U_MARK_TOPICS),phpbb.closeDarkenWrapper(3e3)}),phpbb.addAjaxCallback("notification.mark_all_read",function(a){"undefined"!=typeof a.success&&(phpbb.markNotifications(t("#notification_list li.noti-unread"),0),phpbb.closeDarkenWrapper(3e3))}),phpbb.addAjaxCallback("notification.mark_read",function(a){if("undefined"!=typeof a.success){var e=Number(t("#notification_list_button em").html())-1;phpbb.markNotifications(t(this).parent("li.noti-unread"),e)}}),phpbb.markNotifications=function(a,e){a.removeClass("noti-unread"),a.find("a.mark_read").remove(),a.find("a.tmp_read").removeClass("tmp_read"),a.each(function(){var a=t(this).find("a");a.attr("href",a.attr("data-real-url"))}),t("em","#notification_list_button").html(e),e||t("#mark_all_notifications").remove();var o=t("title"),n=o.text().replace(/(\((\d+)\))/,"");o.text((e?"("+e+")":"")+n)},phpbb.addAjaxCallback("post_delete",function(){var a,e=t(this);if(void 0===e.attr("data-refresh")){a=e[0].href.split("&p=")[1];var o=e.parents("#p"+a).css("pointer-events","none");if(o.hasClass("bg1")||o.hasClass("bg2")){var n=o.nextAll(".bg1");o.nextAll(".bg2").removeClass("bg2").addClass("bg1"),n.removeClass("bg1").addClass("bg2")}o.fadeOut(function(){t(this).remove()})}}),phpbb.addAjaxCallback("post_visibility",function(a){var e=a.visible?t(this):t(this).parents(".post");t(e).css("pointer-events","none").fadeOut(function(){t(this).remove()}),a.visible&&e.parents(".post").find(".post_deleted_msg").css("pointer-events","none").fadeOut(function(){t(this).remove()})}),phpbb.addAjaxCallback("row_delete",function(){t(this).parents("tr").remove()}),phpbb.addAjaxCallback("zebra",function(a){var e;a.success&&(e=t(".zebra"),e.first().html(a.MESSAGE_TEXT),e.not(":first").html("&nbsp;").prev().html("&nbsp;"))}),phpbb.addAjaxCallback("vote_poll",function(a){if("undefined"!=typeof a.success){var e=t(".topic_poll"),o=e.find(".panel"),n=e.find("dl:first-child .resultbar").is(":visible"),i=0,r=function(t){t="undefined"==typeof t?o.find(".inner").outerHeight():t,o.css("min-height",t)};r(),n||e.find(".poll_view_results").hide(500),a.can_vote?e.find(".resultbar, .poll_option_percent, .poll_total_votes").show(500):e.find(".polls, .poll_max_votes, .poll_vote, .poll_option_select").fadeOut(500,function(){e.find(".resultbar, .poll_option_percent, .poll_total_votes").show(500)}),e.find("[data-poll-option-id]").each(function(){var e=t(this),o=e.attr("data-poll-option-id");i=a.vote_counts[o]>=i?a.vote_counts[o]:i}),e.find(".poll_total_vote_cnt").html(a.total_votes),e.find("[data-poll-option-id]").each(function(){{var e=t(this),o=e.attr("data-poll-option-id"),n="undefined"!=typeof a.user_votes[o],r=a.vote_counts[o]===i,l=a.total_votes?Math.round(a.vote_counts[o]/a.total_votes*100):0;0===i?0:Math.round(a.vote_counts[o]/i*100)}e.toggleClass("voted",n),e.toggleClass("most-votes",r);var s=e.find(".resultbar div"),d=a.can_vote?500:1500,c=100===l?"pollbar5":"pollbar"+(Math.floor(l/20)+1);setTimeout(function(){s.animate({width:l+"%"},500).removeClass("pollbar1 pollbar2 pollbar3 pollbar4 pollbar5").addClass(c).html(l+"%");l?l+"%":a.NO_VOTES;e.find(".poll_option_percent").html(a.vote_counts[o])},d)}),a.can_vote||e.find(".polls").delay(400).fadeIn(500);var l=a.can_vote?300:900;e.find(".vote-submitted").delay(l).slideDown(200,function(){t(this).delay(5e3).fadeOut(500,function(){})})}}),t(".poll_view_results a").click(function(a){a.preventDefault();var e=t(this).parents(".topic_poll");e.find(".resultbar, .poll_option_percent, .poll_total_votes").show(500),e.find(".poll_view_results").hide(500)}),t("[data-ajax]").each(function(){var a=t(this),e=a.attr("data-ajax"),o=a.attr("data-filter");if("false"!==e){var n="true"!==e?e:null;o=void 0!==o?phpbb.getFunctionByName(o):null,phpbb.ajaxify({selector:this,refresh:void 0!==a.attr("data-refresh"),filter:o,callback:n})}}),t("#qr_full_editor").click(function(){t("#qr_postform").attr("action",function(t,a){return a+"#preview"})}),t("#member_search").click(function(){var a=t("#memberlist_search");return a.slideToggle("fast"),phpbb.ajaxCallbacks.alt_text.call(this),a.is(":visible")&&t("#username").focus(),!1}),t(document).on("click",".dropdown-notification",function(t){t.stopPropagation()})}(jQuery);